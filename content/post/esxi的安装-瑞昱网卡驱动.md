+++
title = "Esxi的安装和使用"  # 文章标题
date = 2019-10-01T00:18:25+08:00  # 自动添加日期信息
draft = false  # 设为false可被编译为HTML，true供本地修改
tags = ["esxi"]  # 文章标签，可设置多个，用逗号隔开。Hugo会自动生成标签的子URL
categories = ["服务器","运维"]
toc = true
preserveTaxonomyNames = true
disablePathToLower = true
+++

> 本文为原创文章，转载注明出处，欢迎关注网站[https://hkvision.cn](https://hkvision.cn)

## 起源
最近组里面新进了一个联想服务器，配置相当高级，让我大开眼界，算是见识了一把什么叫高端机架式服务器。先说说硬件上面的坑吧，大概有以下三点

- 没有网卡，只有光纤，咱机房里面又没有光交换机（有一个，但是是人家的专线，咱用不了）
- 电源口不是国标的，插插座的那一头是一个三横孔的（网上查的是接UPS的），放一个图片给大家看看
  ![三横孔](https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1345850580,2423916412&fm=26&gp=0.jpg)
- 没显卡，cuda啥的做不了，并且想插个显卡上去还很复杂，要买转接卡啥的，麻烦就算了

我们重新买了个网卡，换了个2u的挡板插上去了，又买了两个电源转接头（拿去电脑城居然还不认识），算是把服务器开起来了。然后开始折腾软件

最开始服务器装的是`Ubuntu Server 18.04.3`，装的过程倒没啥可说的。关键是最后我们开`xrdp`，远程进去的那个界面太空了，就是gnome的经典界面，我想改成有侧边栏啥的都不行。由于服务器是要给组里面的人用的，万一大家觉得这太麻烦了不用了岂不是就白费了。于是我开始折腾esxi，走上了虚拟化的道路。

## 安装
由于是联想的服务器，所以我们找了联想针对我们服务器型号提供的iso文件，用的6.7U3的版本，写到u盘里面，好嘛，碰到了第一个问题。我用的`Win32diskimg`这个工具，但是这个工具写进去之后，不能引导，得，老老实实用软碟通。

安装过程没啥说的，esxi被装到了另外一个u盘里面。

好，那么问题来了，记得我们前面说的，光纤用不了，我们自己买了个网卡的事吗？对，我们一开始没想别的，弄的是瑞昱的卡，**可是！esxi并不自带瑞昱卡的驱动**，人家只有Intel的卡才自带驱动。好嘛，继续折腾，网卡是不可能换了，那就去弄驱动去。

由于是在另外一个电脑里面弄的，具体指令我不太记得了，先给大家一个[链接](https://blog.whsir.com/post-3377.html)参考。主要流程按照来就行了，这里我点几个不一样的地方

- 碰到`系统上禁止运行脚本`这个问题的时候，按`y`确认是没用的，请按`a`也就是全部确认
- 执行这一步`.\ESXi-Customizer-PS-v2.6.0.ps1 -v67 -vft -load net55-r8168`的时候，我看了两个人的文章（另一个在[这里](http://koolshare.cn/forum.php?mod=viewthread&tid=138068)），都说要梯子，可是你看看我写这篇文章的时间就知道了，原来那个梯子已经不能用了。于是我研究了下`.\ESXi-Customizer-PS-v2.6.0.ps1 -h`，把命令改了下，改成了
  ``` shell
  ESXi-Customizer-PS-v2.6.0.ps1 -izip {联想的zip文件} -dpt {从那个列表下载好的驱动的zip文件} -load net55-r8168
  ```
  这里解释一下新的option的意思
  - `izip`：代表我不从网上下原始镜像了（都连不上哪能下载呢），我提供了一个安装包文件，也就是我的安装文件的bundle（联想提供了iso和zip）
  - `dpt`: 代表我不要连接网上的包列表，我自己提供一个本地的包列表，就是我从[这里](https://vibsdepot.v-front.de/wiki/index.php/List_of_currently_available_ESXi_packages)下载的驱动文件，zip格式的
  - `load`：代表我要添加`net55-r8168`这个驱动。

  
用这个方法可以完全不用梯子，纯本地化。

好了，现在我们用软碟通把新的iso文件写u盘，然后安装吧，这个时候就可以识别网卡了，具体的型号具体看哦。

未完待续...（后面还会有安装虚拟机，iscsi的内容，等我先去探探路）

第二部分完成，请继续阅读:[esxi+nas+openwrt的网络构架和安装](https://hkvision.cn/2019/10/07/esxi-nas-openwrt/)
第三部分完成，请继续阅读:[ipxe+网启+ISCSI](https://hkvision.cn/2019/10/15/ipxe-netboot-iscsi-%E7%BD%91%E7%BB%9C%E5%90%AF%E5%8A%A8/)



